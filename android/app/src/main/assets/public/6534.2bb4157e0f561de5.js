"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6534],{6534:(K,D,a)=>{a.r(D),a.d(D,{DocumentsPageModule:()=>G});var d=a(9808),m=a(4182),n=a(5362),C=a(655),g=a(5419),e=a(2096),f=function(i){function l(){return null!==i&&i.apply(this,arguments)||this}return(0,C.ZT)(l,i),l.prototype.getFile=function(t){return(0,g.DM)(this,"getFile",{},arguments)},l.prototype.getFileMetadata=function(t){return(0,g.DM)(this,"getFileMetadata",{},arguments)},l.pluginName="Chooser",l.plugin="cordova-plugin-chooser",l.pluginRef="chooser",l.repo="https://github.com/cyph/cordova-plugin-chooser",l.platforms=["Android","iOS"],l.\u0275fac=function(){var t;return function(s){return(t||(t=e.n5z(l)))(s||l)}}(),l.\u0275prov=e.Yz7({token:l,factory:function(t){return l.\u0275fac(t)}}),l}(g.KY),U=a(933),T=a(2028),M=a(1247),p=a(1946),v=a(7029),_=a(6388);function y(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item-group")(1,"ion-item-divider",8)(2,"ion-label")(3,"h2"),e._uU(4,"Carica da"),e.qZA()()(),e.TgZ(5,"ion-radio-group",17),e.NdJ("ngModelChange",function(s){return e.CHM(t),e.oxw().sorgenteFile=s}),e.TgZ(6,"ion-item"),e._UZ(7,"ion-icon",18),e.TgZ(8,"ion-label"),e._uU(9,"Cartella Documenti"),e.qZA(),e._UZ(10,"ion-radio",19),e.qZA(),e.TgZ(11,"ion-item"),e._UZ(12,"ion-icon",20),e.TgZ(13,"ion-label"),e._uU(14,"Photo Gallery"),e.qZA(),e._UZ(15,"ion-radio",21),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.sorgenteFile)}}function N(i,l){1&i&&(e.TgZ(0,"ion-label",22),e._uU(1,"Scegli una tipologia"),e.qZA())}function I(i,l){1&i&&(e.TgZ(0,"ion-label",22),e._uU(1,"Fai clic e scegli il file"),e.qZA())}function x(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().onDesktopSearch()}),e.TgZ(1,"input",23),e.NdJ("change",function(s){return e.CHM(t),e.oxw().onChangedDesktopFile(s)}),e.qZA(),e._UZ(2,"ion-icon",24),e.YNc(3,I,2,0,"ion-label",11),e.TgZ(4,"p"),e._uU(5),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",!t.loadedDesktopFile),e.xp6(2),e.Oqu(t.fileNameShow)}}function P(i,l){1&i&&(e.TgZ(0,"ion-label",22),e._uU(1,"Scegli il file"),e.qZA())}function F(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().onMobileSearch()}),e._UZ(1,"ion-icon",24),e.YNc(2,P,2,0,"ion-label",11),e._uU(3),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.fileLoaded),e.xp6(1),e.hij(" ",t.fileNameShow," ")}}let A=(()=>{class i{constructor(t,o,s,r){this.chooser=t,this.toastController=o,this.pickerController=s,this.modalController=r,this.fileLoaded=!1,this.fileNameShow="",this.sorgenteFile=p.GN.photoGallery,this.docDescription=""}ngOnInit(){}onMobileSearch(){this.sorgenteFile==p.GN.filesystem?this.chooser.getFile().then(t=>{this.loadedMobileFile=t,this.fileLoaded=!0,this.fileNameShow=this.loadedMobileFile.name}).catch(t=>{this.loadedMobileFile=null,this.fileLoaded=!1,this.fileNameShow="",console.error(t)}):this.sorgenteFile==p.GN.photoGallery&&_.V1.getPhoto({resultType:_.dk.DataUrl,source:_.oK.Prompt,quality:100}).then(t=>{this.loadedMobilePhoto=t,this.fileLoaded=!0,this.fileNameShow="Immagine "+this.loadedMobilePhoto.format}).catch(t=>{this.loadedMobilePhoto=null,this.fileLoaded=!1,this.fileNameShow="",this.showMessage("Errore apertura Photo Gallery")})}onDesktopSearch(){document.getElementById("myInput").click()}onChangedDesktopFile(t){let o;t.target.files&&0!=t.target.files.length?(o=t.target.files[0],this.loadedDesktopFile=o,this.fileLoaded=!0,this.fileNameShow=this.loadedDesktopFile.name):(this.loadedDesktopFile=null,this.fileLoaded=!1,this.fileNameShow="")}showMessage(t){this.toastController.create({message:t,duration:3e3}).then(o=>{o.present()})}showPicker(){let t=[];this.docTypeList.forEach(o=>{t.push({text:o.DENOMINAZIONE,value:o})}),this.pickerController.create({columns:[{name:"tipo",options:t}],buttons:[{text:"Annulla",role:"cancel"},{text:"Conferma",handler:o=>{this.selectedDocType=o.tipo.value}}]}).then(o=>{o.present()})}convertBlobToDataUrl(t){return new Promise((o,s)=>{const r=new FileReader;r.onerror=s,r.onload=()=>{o(r.result.toString())},r.readAsDataURL(t)})}onClickCarica(){this.fileLoaded?this.selectedDocType?this.SendFileDocumentToParent():this.showMessage("Scegli una tipologia di documento"):this.showMessage("Prima scegli il documento")}prepareDataUrl(){let t;return new Promise((o,s)=>{this.loadedDesktopFile?this.convertBlobToDataUrl(this.loadedDesktopFile).then(r=>{t=r,o(t)}).catch(r=>{s(r)}):this.loadedMobilePhoto?(t=this.loadedMobilePhoto.dataUrl,0!=t.length?o(t):s("No base 64 founded")):this.loadedMobileFile&&o(this.loadedMobileFile.dataURI)})}SendFileDocumentToParent(){this.prepareDataUrl().then(t=>{let o=new v.U;o.FILE=t,o.IDTIPODOCUMENTAZIONE=this.selectedDocType.ID,o.DESCRIZIONE=this.docDescription,this.modalController.dismiss(o)}).catch(t=>{this.showMessage("Si sono verificati errori")})}close(){this.modalController.dismiss()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f),e.Y36(n.yF),e.Y36(n.up),e.Y36(n.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-upload"]],inputs:{isDesktop:"isDesktop",docTypeList:"docTypeList"},decls:36,vars:6,consts:[["color","primary"],["slot","end"],[3,"click"],["name","close-outline"],[1,"icon-container"],["name","cloud-upload-outline"],[4,"ngIf"],[1,"ion-margin-vertical"],["color","light"],["button","",3,"click"],["slot","start","name","document-outline"],["class","myPlaceholder",4,"ngIf"],["slot","start","name","information-circle-outline"],["placeholder","Inserisci una descrizione","maxlength","50",3,"ngModel","ngModelChange"],["button","",3,"click",4,"ngIf"],["expand","block",3,"click"],["slot","start","name","cloud-upload-outline"],[3,"ngModel","ngModelChange"],["slot","start","name","document-text-outline"],["slot","end","value","file"],["slot","start","name","camera-outline"],["slot","end","value","photo"],[1,"myPlaceholder"],["accept",".pdf, image/*","hidden","","id","myInput","type","file",3,"change"],["slot","start","name","folder-open-outline"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"Carica"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e.NdJ("click",function(){return o.close()}),e._UZ(6,"ion-icon",3),e.qZA()()()(),e.TgZ(7,"ion-content")(8,"div",4),e._UZ(9,"ion-icon",5),e.qZA(),e.TgZ(10,"ion-list"),e.YNc(11,y,16,1,"ion-item-group",6),e.TgZ(12,"ion-item-group",7)(13,"ion-item-divider",8)(14,"ion-label")(15,"h2"),e._uU(16,"Cosa stai caricando"),e.qZA()()(),e.TgZ(17,"ion-item",9),e.NdJ("click",function(){return o.showPicker()}),e._UZ(18,"ion-icon",10),e.YNc(19,N,2,0,"ion-label",11),e.TgZ(20,"p"),e._uU(21),e.qZA()(),e.TgZ(22,"ion-item"),e._UZ(23,"ion-icon",12),e.TgZ(24,"ion-textarea",13),e.NdJ("ngModelChange",function(r){return o.docDescription=r}),e.qZA()()(),e.TgZ(25,"ion-item-group",7)(26,"ion-item-divider",8)(27,"ion-label")(28,"h2"),e._uU(29,"Scegli il documento"),e.qZA()()(),e.YNc(30,x,6,2,"ion-item",14),e.YNc(31,F,4,2,"ion-item",14),e.qZA()()(),e.TgZ(32,"ion-footer")(33,"ion-button",15),e.NdJ("click",function(){return o.onClickCarica()}),e._UZ(34,"ion-icon",16),e._uU(35," Carica "),e.qZA()()),2&t&&(e.xp6(11),e.Q6J("ngIf",!o.isDesktop),e.xp6(8),e.Q6J("ngIf",!o.selectedDocType),e.xp6(2),e.Oqu(o.selectedDocType?o.selectedDocType.DENOMINAZIONE:null),e.xp6(3),e.Q6J("ngModel",o.docDescription),e.xp6(6),e.Q6J("ngIf",o.isDesktop),e.xp6(1),e.Q6J("ngIf",!o.isDesktop))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,n.gu,n.W2,n.q_,d.O5,n.Ub,n.rH,n.Q$,n.se,n.QI,m.JJ,m.On,n.Ie,n.B7,n.U5,n.g2,n.j9,m.nD,n.fr],styles:[".myPlaceholder[_ngcontent-%COMP%]{color:gray}.icon-container[_ngcontent-%COMP%]{padding-top:20px;text-align:center}.icon-container[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:150px;color:gray}"]}),i})();var S=a(7266),Z=a(7587),E=a(8223),O=a(5351),b=a(4901),k=a(1111),w=a(3834),q=a(5031);function J(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-buttons",7)(1,"ion-button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().onAddDocument()}),e._UZ(2,"ion-icon",9),e.qZA()()}}function Y(i,l){1&i&&(e.TgZ(0,"div",10)(1,"ion-label"),e._uU(2,"Nessun documento"),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4,"disponibile"),e.qZA()())}function R(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",8),e.NdJ("click",function(){const r=e.CHM(t).$implicit;return e.oxw(2).onClickElement(r)}),e._UZ(1,"ion-icon",12),e.TgZ(2,"ion-label")(3,"h3"),e._uU(4),e.qZA(),e.TgZ(5,"p"),e._uU(6),e.ALo(7,"date"),e.qZA()(),e._UZ(8,"ion-icon",13),e.qZA()}if(2&i){const t=l.$implicit;e.xp6(4),e.Oqu(t._DENOMINAZIONE_TipoDocumentazione),e.xp6(2),e.hij("Ultima modifica: ",e.xi3(7,2,t.DATAORAMODIFICA,"dd/LL/yyyy"),"")}}function L(i,l){if(1&i&&(e.TgZ(0,"div")(1,"ion-list"),e.YNc(2,R,9,5,"ion-item",11),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.listDocumenti)}}const Q=[{path:"",component:(()=>{class i{constructor(t,o,s,r,h,u,c,B,H,j){this.startService=t,this.chooser=o,this.toastController=s,this.modalController=r,this.docStructureService=h,this.loadingController=u,this.platform=c,this.file=B,this.fileOpener=H,this.fileService=j,this.listDocumenti=[],this.inRichiesta=!0,this.listaTipiDocumento=[]}ngOnInit(){this.inRichiesta=!1,this.requestTipiDocumento(),this.requestListaDocumenti()}requestListaDocumenti(t){let o=new S.Kl;o.decode.active=!0,o.decode.addForeignField("IDTIPODOCUMENTAZIONE"),this.startService.actualUtente?this.loadingController.create({message:"Caricamento",spinner:"circular",backdropDismiss:!0}).then(s=>{t||s.present(),this.docStructureService.loadCollection(this.startService.actualUtente,"DOCUMENTAZIONI",o).then(r=>{t?t.target.complete():s.dismiss(),this.listDocumenti=r.DOCUMENTAZIONI}).catch(r=>{t?t.target.complete():s.dismiss(),console.log(r),this.showMessage("Errore di connessione"),this.listDocumenti=[]})}):this.listDocumenti=[]}requestTipiDocumento(){let t=new p.vV(!0);t.ZORDER=0,t.addFilterCondition(Z.Wh.maggiore,"ZORDER"),this.docStructureService.requestNew(t).then(o=>{this.listaTipiDocumento=o})}onAddDocument(){this.modalController.create({component:A,componentProps:{isDesktop:this.startService.isDesktop,docTypeList:this.listaTipiDocumento}}).then(t=>{t.present(),t.onWillDismiss().then(o=>{this.requestUploadToServer(o.data)})})}requestUploadToServer(t){t&&this.loadingController.create({message:"Caricamento",spinner:"circular",backdropDismiss:!0}).then(o=>{o.present();let s=new O.oD;t.TOKENUTENTE=this.startService.actualUtente.ID;let r=new Z.bY;r.clearDOProperty=!0,r.clearPKProperty=!0,r.clearPrivateProperty=!0,r.onlyPropertyModified=!1,r.onlyDocModified=!1;let h=t.exportToJSON(r);this.docStructureService.requestForFunction(s,"uploadDocumentazione",h).then(u=>{o.dismiss();let c=new b.D;c=u.response,c?c.result?(this.showMessage("Caricamento completato"),this.requestListaDocumenti()):this.showMessage(c.message&&0!==c.message.length?c.message:"Errore caricamento"):this.showMessage("Errore di connessione")}).catch(u=>{o.dismiss(),console.log(u),this.showMessage("Errore di connnessione")})})}onClickElement(t){t&&t.FILENAMEESTENSIONE&&t.FILENAMEESTENSIONE.length>0?this.loadingController.create({message:"Caricamento",spinner:"circular",backdropDismiss:!0}).then(o=>{o.present(),this.startService.requestDocumento(t.FILENAMEESTENSIONE).then(s=>{o.dismiss(),s?this.fileService.open(s):this.showMessage("File non visualizzabile")}).catch(s=>{o.dismiss(),console.log(s),this.showMessage("Impossibile scaricare il file")})}):this.showMessage("Errore, file non presente in archivio")}showMessage(t){this.toastController.create({message:t,duration:3e3}).then(o=>{o.present()})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(M.D),e.Y36(f),e.Y36(n.yF),e.Y36(n.IN),e.Y36(E.l),e.Y36(n.HT),e.Y36(n.t4),e.Y36(k.$),e.Y36(w.u),e.Y36(q.I))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-documents"]],decls:12,vars:3,consts:[["color","primary"],["slot","start"],["defaultHref","/account"],["slot","end",4,"ngIf"],["slot","fixed",3,"ionRefresh"],["class","nofind-cnt",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"click"],["name","add"],[1,"nofind-cnt"],[3,"click",4,"ngFor","ngForOf"],["slot","start","color","","name","document-text-outline",1,"icon-left"],["slot","end","color","primary","name","cloud-download-outline"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"I tuoi documenti"),e.qZA(),e.YNc(6,J,3,0,"ion-buttons",3),e.qZA()(),e.TgZ(7,"ion-content")(8,"ion-refresher",4),e.NdJ("ionRefresh",function(r){return o.requestListaDocumenti(r)}),e._UZ(9,"ion-refresher-content"),e.qZA(),e.YNc(10,Y,5,0,"div",5),e.YNc(11,L,3,1,"div",6),e.qZA()),2&t&&(e.xp6(6),e.Q6J("ngIf",0!=(null==o.listaTipiDocumento?null:o.listaTipiDocumento.length)),e.xp6(4),e.Q6J("ngIf",0===o.listDocumenti.length),e.xp6(1),e.Q6J("ngIf",o.listDocumenti.length>0))},directives:[n.Gu,n.sr,n.Sm,n.oU,n.cs,n.wd,d.O5,n.YG,n.gu,n.W2,n.nJ,n.Wo,n.Q$,n.q_,d.sg,n.Ie],pipes:[d.uU],styles:["#doc-nofind-cnt[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;align-content:center;height:100%;padding:0;margin:0;display:-webkit-flex;background-color:var(--ion-color-light);color:var(--ion-color-warning)}.icon-left[_ngcontent-%COMP%]{font-size:40px}"]}),i})()}];let z=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[T.Bz.forChild(Q)],T.Bz]}),i})(),G=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[f],imports:[[d.ez,m.u5,n.Pc,z,U.q]]}),i})()}}]);