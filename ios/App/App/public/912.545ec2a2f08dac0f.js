"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[912],{912:(R,h,r)=>{r.r(h),r.d(h,{InvoicesPageModule:()=>x});var u=r(9808),d=r(4182),s=r(5362),m=r(2028),f=r(1247),g=r(1111),p=r(3834),T=r(5351),e=r(2096),v=r(4021);let I=(()=>{class o{transform(t){let i="";return i=v.Gs.decode(v.Dl,t),i}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275pipe=e.Yjl({name:"tipomasterdocumento",type:o,pure:!0}),o})();function A(o,l){1&o&&(e.TgZ(0,"div",9)(1,"ion-label"),e._uU(2,"Nessuna ricevuta"),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4,"disponibile"),e.qZA()())}function Z(o,l){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.NOTESSTAMPA)}}function P(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",11),e.NdJ("click",function(){const n=e.CHM(t).$implicit;return e.oxw(2).onClickElement(n)}),e._UZ(1,"ion-icon",12),e.TgZ(2,"ion-label")(3,"h3"),e._uU(4),e.ALo(5,"tipomasterdocumento"),e.qZA(),e.TgZ(6,"p"),e._uU(7),e.ALo(8,"date"),e.qZA(),e.YNc(9,Z,2,1,"p",8),e.qZA(),e.TgZ(10,"ion-chip",13),e._uU(11),e.ALo(12,"currency"),e.qZA()()}if(2&o){const t=l.$implicit;e.xp6(4),e.AsE("",e.lcZ(5,5,t.TIPOLOGIA)," num. ",t.NUMEROSTAMPA,""),e.xp6(3),e.hij("Emessa il: ",e.xi3(8,7,t.DATADOCUMENTO,"dd/LL/yyyy"),""),e.xp6(2),e.Q6J("ngIf",t.NOTESSTAMPA&&0!==t.NOTESSTAMPA.length),e.xp6(2),e.Oqu(e.xi3(12,10,t.TOTDOCUMENTO,"EUR"))}}function M(o,l){if(1&o&&(e.TgZ(0,"div")(1,"ion-list"),e.YNc(2,P,13,13,"ion-item",10),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.listRicevute)}}const U=[{path:"",component:(()=>{class o{constructor(t,i,c,n,a,O){this.loadingController=t,this.startService=i,this.file=c,this.fileOpener=n,this.toastController=a,this.navController=O,this.actualUtente=new T.oD,this.listRicevute=[],this.selectedYear=(new Date).toISOString()}ngOnInit(){this.actualUtente=this.startService.actualUtente,this.actualUtente?this.requestRicevute():this.navController.navigateRoot("/home")}requestRicevute(t){let c=new Date(this.selectedYear).getFullYear();t?this.startService.requestInvoices(this.actualUtente,c).then(n=>{this.listRicevute=n,t.target.complete()}).catch(n=>{console.log(n),this.showMessage("Errore di connessione"),t.target.complete()}):this.loadingController.create().then(n=>{n.present(),this.startService.requestInvoices(this.actualUtente,c).then(a=>{this.listRicevute=a,n.dismiss()}).catch(a=>{console.log(a),this.showMessage("Errore di connessione"),n.dismiss()})})}onClickElement(t){this.loadingController.create({message:"Caricamento",spinner:"circular",backdropDismiss:!0}).then(i=>{i.present(),this.startService.downloadInvoice(t).then(c=>{i.dismiss(),c.result?this.startService.base64toBlob(c.code).then(n=>{this.startService.isDesktop?this.openDesktop(n):this.openMobile(n)}):this.showMessage(c.message)}).catch(c=>{i.dismiss(),console.log(c),this.showMessage("Errore di connessione")})})}openDesktop(t){let c=window.URL.createObjectURL(t),n=document.createElement("a");n.download="File",n.href=c,document.body.appendChild(n),n.click(),document.body.removeChild(n)}openMobile(t){this.file.writeFile(this.file.cacheDirectory,"Documento",t,{replace:!0}).then(n=>{this.fileOpener.open(n.toURL(),t.type).then(()=>console.log("File is opened")).catch(a=>console.error("Error openening file: "+a))}).catch(n=>{throw console.error("Error creating file: "),console.log(n),n})}showMessage(t){this.toastController.create({message:t,duration:3e3}).then(i=>{i.present()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(s.HT),e.Y36(f.D),e.Y36(g.$),e.Y36(p.u),e.Y36(s.yF),e.Y36(s.SH))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-invoices"]],decls:16,vars:3,consts:[["color","primary"],["slot","start"],["defaultHref","/account"],["lines","none","color",""],["displayFormat","YYYY","placeholder","Periodo attuale","min","2000","max","2099","cancelText","Annulla","doneText","Conferma",3,"ngModel","ngModelChange"],["name","chevron-down-outline","color","primary","slot","end"],["slot","fixed",3,"ionRefresh"],["class","nofind-cnt",4,"ngIf"],[4,"ngIf"],[1,"nofind-cnt"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],["slot","start","color","","name","document-text-outline",1,"icon-left"],["color","primary","slot","end"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Le tue ricevute"),e.qZA()(),e.TgZ(6,"ion-item",3)(7,"ion-label"),e._uU(8,"Periodo"),e.qZA(),e.TgZ(9,"ion-datetime",4),e.NdJ("ngModelChange",function(n){return i.selectedYear=n})("ngModelChange",function(){return i.requestRicevute()}),e.qZA(),e._UZ(10,"ion-icon",5),e.qZA()(),e.TgZ(11,"ion-content")(12,"ion-refresher",6),e.NdJ("ionRefresh",function(n){return i.requestRicevute(n)}),e._UZ(13,"ion-refresher-content"),e.qZA(),e.YNc(14,A,5,0,"div",7),e.YNc(15,M,3,1,"div",8),e.qZA()),2&t&&(e.xp6(9),e.Q6J("ngModel",i.selectedYear),e.xp6(5),e.Q6J("ngIf",0===i.listRicevute.length),e.xp6(1),e.Q6J("ngIf",i.listRicevute.length>0))},directives:[s.Gu,s.sr,s.Sm,s.oU,s.cs,s.wd,s.Ie,s.Q$,s.x4,s.QI,d.JJ,d.On,s.gu,s.W2,s.nJ,s.Wo,u.O5,s.q_,u.sg,s.hM],pipes:[I,u.uU,u.H9],styles:[""]}),o})()}];let y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[m.Bz.forChild(U)],m.Bz]}),o})();var C=r(4586);let x=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[g.$,p.u],imports:[[u.ez,d.u5,s.Pc,y,C.D]]}),o})()}}]);