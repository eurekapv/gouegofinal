{"version":3,"sources":["./src/app/pages/history/historycourse/allegatilist/allegatilist.page.ts","./src/app/pages/history/historycourse/allegatilist/allegatilist.page.html","./src/app/services/file.service.ts"],"names":[],"mappings":"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","file":"default~pages-history-historycourse-historycourse-module~pages-home-home-module~pages-location-cours~979ea316-es2015.js","sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\r\nimport { LoadingController, ModalController, ToastController } from '@ionic/angular';\r\nimport { element } from 'protractor';\r\nimport { RequestDecode, RequestParams } from 'src/app/library/models/requestParams.model';\r\nimport { DocstructureService } from 'src/app/library/services/docstructure.service';\r\nimport { Corso } from 'src/app/models/corso.model';\r\nimport { CorsoAllegato } from 'src/app/models/corsoallegato.model';\r\nimport { FileService } from 'src/app/services/file.service';\r\nimport { StartService } from 'src/app/services/start.service';\r\n\r\n@Component({\r\n  selector: 'app-allegatilist',\r\n  templateUrl: './allegatilist.page.html',\r\n  styleUrls: ['./allegatilist.page.scss'],\r\n})\r\nexport class AllegatilistPage implements OnInit {\r\n  \r\n  @Input() myCorso:Corso\r\n  listAllegati: CorsoAllegato[] = [];\r\n\r\n\r\n  constructor(\r\n    private loadingController: LoadingController,\r\n    private modalController: ModalController,\r\n    private toastController: ToastController,\r\n    private startService: StartService,\r\n    private fileService: FileService\r\n    \r\n  ) { }\r\n\r\n  ngOnInit() {\r\n\r\n    this.requestListAllegati();    \r\n  }\r\n\r\n\r\n  requestListAllegati(event?: any){\r\n\r\n    \r\n\r\n    this.loadingController.create({\r\n      message: 'Caricamento...',\r\n      spinner: \"circular\",\r\n      backdropDismiss: true\r\n    })\r\n    .then(elLoading => {\r\n      \r\n      //il loading Ã¨ pronto\r\n      if(!event){\r\n        elLoading.present();\r\n      }\r\n      return this.startService.requestListAllegatiByIdCorso(this.myCorso.ID);\r\n    })\r\n    .then(listAllegati => {\r\n\r\n      //i dati sono arrivati\r\n      if(event){\r\n        event.target.complete();\r\n      }\r\n      else{\r\n        this.loadingController.dismiss();\r\n      }\r\n      this.listAllegati = listAllegati;\r\n    })\r\n    .catch(error => {\r\n\r\n      //i dati non sono arrivati\r\n      if(event){\r\n        event.target.complete();\r\n      }\r\n      else{\r\n        this.loadingController.dismiss();\r\n      }\r\n      this.showMessage('Errore di connessione')\r\n      console.error(error);\r\n    })\r\n  }\r\n\r\n\r\n\r\n  onClose(){\r\n    this.modalController.dismiss();\r\n  }\r\n\r\n\r\n\r\n\r\n  showMessage (messaggio : string){\r\n    this.toastController.create({\r\n      message: messaggio,\r\n      duration: 3000\r\n\r\n    }).then (elModal => {\r\n      elModal.present();\r\n    })\r\n  }\r\n\r\n  downloadAllegato(elemento: CorsoAllegato){\r\n    if(elemento && elemento.FILENAMEESTENSIONE && elemento.FILENAMEESTENSIONE.length > 0){\r\n      //ho il percorso per scaricare il file\r\n      \r\n      this.loadingController.create({\r\n        message: 'Caricamento',\r\n        spinner: 'circular',\r\n        backdropDismiss: true\r\n      })\r\n      .then(elLoading => {\r\n        elLoading.present();\r\n\r\n        return this.startService.requestDocumento(elemento.FILENAMEESTENSIONE);\r\n      })\r\n      .then(elBlob => {\r\n        this.loadingController.dismiss();\r\n\r\n        console.log(elBlob);\r\n        if(elBlob){\r\n          this.fileService.open(elBlob);\r\n        }\r\n        else{\r\n          throw new Error();\r\n        }\r\n      })\r\n      .catch(error => {\r\n        console.log(error);\r\n        this.showMessage('Impossibile scaricare il file');\r\n      })\r\n    }\r\n\r\n\r\n  }\r\n\r\n}\r\n","<ion-header>\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-title>Materiale Allegato</ion-title>\r\n\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button fill=\"clear\" (click)=\"onClose()\">\r\n        <ion-icon name=\"close\"></ion-icon>\r\n      </ion-button>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content>\r\n\r\n  <ion-refresher slot=\"fixed\" (ionRefresh)=\"requestListAllegati($event)\">\r\n    <ion-refresher-content></ion-refresher-content>\r\n  </ion-refresher>\r\n\r\n  <!-- NESSUN DOCUMENTO PRESENTE -->\r\n  <div *ngIf=\"listAllegati.length === 0\" class=\"nofind-cnt\">\r\n    <ion-label>Nessun allegato</ion-label>\r\n    <ion-label>disponibile</ion-label>\r\n  </div>\r\n\r\n\r\n  <!-- DOCUMENTI PRESENTI -->\r\n  <ion-list *ngIf=\"listAllegati.length > 0\">\r\n    <ion-item *ngFor=\"let allegato of listAllegati\" button (click)=\"downloadAllegato(allegato)\">\r\n      <ion-icon slot=\"start\" class=\"\" color =\"\" [name]=\"allegato.fileTypeIconName\"></ion-icon>\r\n        <ion-label>\r\n          <h3>{{allegato.DESCRIZIONE}}</h3>\r\n        </ion-label>\r\n        <ion-icon slot=\"end\" color=\"primary\" name=\"cloud-download-outline\"></ion-icon>\r\n    </ion-item>\r\n  </ion-list>\r\n</ion-content>\r\n","import { Injectable } from '@angular/core';\r\nimport { FileOpener } from '@ionic-native/file-opener/ngx';\r\nimport { File } from '@ionic-native/file/ngx';\r\nimport { Platform } from '@ionic/angular';\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FileService {\r\n\r\n  constructor(\r\n    private file: File,\r\n    private fileOpener: FileOpener,\r\n    private platform: Platform\r\n  ) { }\r\n\r\n  openDesktop(blob: Blob){\r\n\r\n\r\n    //per scaricare il file creo via javascript un link fittizio agganciando il percorso del blob, e ne scateno l'evento click\r\n    let name='File'\r\n    let url  = window.URL.createObjectURL(blob);\r\n    let link = document.createElement(\"a\");\r\n    link.download = name;\r\n    link.href = url;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n\r\n\r\n  }\r\n\r\n  openMobile(blob: Blob){\r\n    let fileName='Documento';         \r\n    let filePath= this.file.cacheDirectory;      \r\n    console.log('percorso: '+filePath);  \r\n\r\n        this.file.writeFile(filePath, fileName, blob, { replace:true }).then((fileEntry) => {\r\n\r\n          console.log(\"File created!\");          \r\n          this.fileOpener.open(fileEntry.toURL(), blob.type)\r\n            .then(() => console.log('File is opened'))\r\n            .catch(err => console.error('Error openening file: ' + err));\r\n        })\r\n          .catch((err) => {\r\n            console.error(\"Error creating file: \");\r\n            console.log(err);\r\n            throw err;  \r\n          });\r\n  }\r\n\r\n\r\n  /**\r\n   * scarica e visualizza un blob da mobile o desktop\r\n   */\r\n  open(blob: Blob){\r\n    if (blob){\r\n\r\n      if(this.platform.is(\"hybrid\")){\r\n        this.openMobile(blob);\r\n      }\r\n      else{\r\n        this.openDesktop(blob);\r\n      }\r\n    }\r\n    else{\r\n      console.log('Blob inesistente');\r\n      throw new Error();\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n}\r\n"],"sourceRoot":"webpack:///"}