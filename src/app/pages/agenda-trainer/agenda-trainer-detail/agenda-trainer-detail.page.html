<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="onGoBack()" fill="clear" >
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Presenze</ion-title>
  </ion-toolbar>
  <ion-toolbar *ngIf="showTabs" mode="md">
    <ion-segment [disabled]="!selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)" id="segment" [(ngModel)]="selectedSegment" (ionChange)="onChangeSegment($event)" color="primary"  >
      <ion-segment-button value="presente" fill="outline" layout="icon-start">
        <ion-icon color="primary" name="thumbs-up"></ion-icon>
        <ion-label>Tutti presenti</ion-label>
      </ion-segment-button >
      <ion-segment-button value="assente" layout="icon-start">
        <ion-icon color="primary" name="thumbs-down"></ion-icon>
        <ion-label>Tutti assenti</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content scrolleEvents (ionScroll)="onScroll($event)">
  <div style="height: 1vh" ></div>
  <div class="ion-no-padding div-header">
    <ion-item lines="none" color="light">
      <ion-icon slot="start" name="school-outline" color="primary">
      </ion-icon>
      <ion-label class="ion-text-wrap">
        <h1>{{selectedPianificazione['_DENOMINAZIONE_Corso']}}</h1>
        <p>{{(selectedPianificazione['_DENOMINAZIONE_Location'] | titlecase) + ' - ' + (selectedPianificazione['_DENOMINAZIONE_Campo'] | titlecase)}}</p>
        <h2>{{selectedPianificazione.DATAORAINIZIO | date: 'H.mm'}} - {{selectedPianificazione.DATAORAFINE | date: 'H.mm'}}</h2>
      </ion-label>
    </ion-item>

  </div>

  <div class="ion-padding-horizontal info">
    
    <p>
      <ion-icon name="information-circle-outline" color="primary"></ion-icon> 
      {{selectedPianificazione.msgCanUpdatePresenze(gapAggiornamentoPresenze)}}
    </p>

  </div>


  <ion-list>
  <!-- Iscritti confermati -->
    <ion-item-group *ngIf="listPresenzeConfermate.length > 0">
      <ion-item-divider>
          <ion-label>
            Partecipanti
          </ion-label>
      </ion-item-divider>
      <ion-item
        *ngFor="let presenza of listPresenzeConfermate" 
        [button]="selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)" 
        (click)="selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)? onClickElement(presenza) : {}"
      >
        <ion-icon *ngIf="presenza.PRESENTE==true" slot="start" name="thumbs-up-outline" color="primary"></ion-icon>
        <ion-icon *ngIf="presenza.PRESENTE==false" slot="start" name="thumbs-down-outline" color="danger"></ion-icon>
        <ion-icon *ngIf="presenza.PRESENTE != true && presenza.PRESENTE != false" slot="start" color="" name="person-circle-outline"></ion-icon>
        <ion-label>
          <h2>{{presenza.NOMINATIVO}}</h2>
          <h4 *ngIf="this.tipoSocieta == TipoSocieta.sportiva">
            Certificato medico: 
            <ion-badge [color]="getColoreCertificato(presenza)" class="custom-badge"> 
              {{presenza.DATACERTIFICATOMEDICO? (presenza.DATACERTIFICATOMEDICO | date: 'dd/MM/yyyy') : ('Non consegnato')}}
            </ion-badge> 
          </h4>
        </ion-label>
        <ion-badge
          *ngIf="presenza.PRESENTE != null && presenza.PRESENTE != undefined && isDesktop"
          slot="end"
          [color]="presenza.PRESENTE? 'primary' : 'danger'"
        >
        {{presenza.PRESENTE? 'Presente' : 'Assente'}}
        </ion-badge>
      </ion-item>
    </ion-item-group>

    <!-- Iscritti in prova -->
    <ion-item-group *ngIf="listPresenzeInProva.length > 0">
      <ion-item-divider>
        <ion-label>
          In Prova
        </ion-label>
      </ion-item-divider>
      <ion-item 
        *ngFor="let presenza of listPresenzeInProva" 
        [button]="selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)" 
        (click)="selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)? onClickElement(presenza) : {}">
        <ion-icon *ngIf="presenza.PRESENTE==true" slot="start" name="thumbs-up-outline" color="primary"></ion-icon>
        <ion-icon *ngIf="presenza.PRESENTE==false" slot="start" name="thumbs-down-outline" color="danger"></ion-icon>
        <ion-icon *ngIf="presenza.PRESENTE != true && presenza.PRESENTE != false" slot="start" color="" name="person-circle-outline"></ion-icon>
        <ion-label>
          <h2>{{presenza.NOMINATIVO}}</h2>
          <h4 *ngIf="tipoSocieta == TipoSocieta.sportiva">
            Certificato medico: 
            <ion-badge [color]="getColoreCertificato(presenza)" class="custom-badge"> 
              {{presenza.DATACERTIFICATOMEDICO? (presenza.DATACERTIFICATOMEDICO | date: 'dd/MM/yyyy') : ('Non consegnato')}}
            </ion-badge> 
          </h4>
        </ion-label>
        <ion-badge
          *ngIf="presenza.PRESENTE != null && presenza.PRESENTE != undefined && isDesktop"
          slot="end"
          [color]="presenza.PRESENTE? 'primary' : 'danger'"
        >
        {{presenza.PRESENTE? 'Presente' : 'Assente'}}
        </ion-badge>
      </ion-item>
    </ion-item-group>

    <!-- Note istruttore -->
    <ion-item-group class="notes" >
      <ion-item-divider>
        <ion-label>
          Note per la segreteria
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-icon slot="start" name="pencil-outline"></ion-icon>
        <ion-textarea [disabled]="!selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)" placeholder="Inserisci una nota"  [(ngModel)]="selectedPianificazione.NOTETRAINER" maxlength="200"></ion-textarea>      
      </ion-item>   
    </ion-item-group>

    <!-- Note segreteria -->
    <ion-item-group class="notes" *ngIf="selectedPianificazione.NOTEADMIN && selectedPianificazione.NOTEADMIN.length > 0">  
      <ion-item-divider>
        <ion-label>
          Note dalla segreteria
        </ion-label>
      </ion-item-divider>
      <ion-item>
        <ion-icon slot="start" name="pencil-outline"></ion-icon>
        <ion-label class="ion-text-wrap">
          <p>
            {{selectedPianificazione.NOTEADMIN}}
          </p>
        </ion-label>
      </ion-item>   
    </ion-item-group>
  </ion-list>
</ion-content>

<ion-footer>
  <ion-button [disabled]="!selectedPianificazione.canUpdatePresenze(gapAggiornamentoPresenze)" color="primary" expand="block" (click)="onSubmit()">
    Conferma
  </ion-button>
</ion-footer>
