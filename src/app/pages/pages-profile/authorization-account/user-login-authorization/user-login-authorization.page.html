<ion-header class="ion-no-border">
  <ion-toolbar color="primary" mode="md">
    <ion-buttons slot="start">
      <ion-button (click)="closeModal()" fill="clear">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ indexShowForm == 1 ? 'Accedi' : 'Recupera Password' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <div class="login-wrapper">
    <ion-grid>
      <ion-row class="ion-align-items-center">
        
        <!-- COLONNA SINISTRA: Header + Immagine -->
        <ion-col sizeXs="12" sizeSm="12" sizeMd="5" sizeLg="6" sizeXl="6" class="left-col">
          
          <!-- HEADER BENTORNATO (solo su tablet/desktop per login) -->
          <div class="welcome-card" *ngIf="indexShowForm == 1">


            <!-- Immagine -->
            <div class="login-image">
              <img [src]="srcImage" alt="Login">
            </div>

          </div>

          <!-- HEADER RECOVERY (solo su tablet/desktop per recovery) -->
          <div class="welcome-section" *ngIf="indexShowForm == 2">
            <div class="form-header">
              <ion-icon name="key" class="form-icon"></ion-icon>
              <h2>Recupera Password</h2>
              <p *ngIf="stepRecovery == 'input'">Ti invieremo un codice</p>
              <p *ngIf="stepRecovery == 'code'">Inserisci il codice</p>
              <p *ngIf="stepRecovery == 'password'">Nuova password</p>
            </div>

            <div class="login-image">
              <img [src]="srcImage" alt="Recovery">
            </div>
          </div>

        </ion-col>

        <!-- COLONNA DESTRA: Solo Form -->
        <ion-col sizeXs="12" sizeSm="12" sizeMd="7" sizeLg="6" sizeXl="6" class="form-col">

          <!-- ================================ -->
          <!-- FORM LOGIN -->
          <!-- ================================ -->
          <div class="form-container" *ngIf="indexShowForm == 1">
            
            <!-- Header -->
            <div class="form-header">
              <ion-icon name="log-in" class="form-icon"></ion-icon>
              <h2>Bentornato!</h2>
              <p>Accedi per continuare con le tue attivit√†</p>
            </div>

            <!-- Link Registrazione -->
            <div class="register-banner" (click)="closeModal(true)">
              <ion-icon name="person-add" color="danger"></ion-icon>
              <div class="register-text">
                <p>Non hai ancora un account?</p>
                <span>Registrati ora</span>
              </div>
              <ion-icon name="chevron-forward" color="danger"></ion-icon>
            </div>

            <!-- Form -->
            <form [formGroup]="formPagePrimary" class="login-form">
              
              <!-- Email -->
              <div class="form-field">
                <ion-icon name="mail" class="field-icon"></ion-icon>
                <ion-input
                  label="E-mail"
                  labelPlacement="floating"
                  type="email"
                  formControlName="profileEmail"
                  placeholder="nome@esempio.com"
                  [clearInput]="true">
                </ion-input>
              </div>

              <!-- Password -->
              <div class="form-field">
                <ion-icon name="lock-closed" class="field-icon"></ion-icon>
                <ion-input
                  #currentpassword
                  label="Password"
                  labelPlacement="floating"
                  type="password"
                  formControlName="profilePassword"
                  placeholder="Inserisci la password">
                </ion-input>
                <ion-button
                  (click)="showHideInput('currentpassword',currentpassword)"
                  fill="clear"
                  size="small"
                  class="eye-button">
                  <ion-icon 
                    [name]="showCurrentPassword ? 'eye-off' : 'eye'" 
                    slot="icon-only">
                  </ion-icon>
                </ion-button>
              </div>

              <!-- Checkbox Memorizza -->
              <div class="form-checkbox">
                <ion-checkbox formControlName="profileSaving" mode="md"></ion-checkbox>
                <span>Ricordami su questo dispositivo</span>
              </div>

              <!-- Bottone Login -->
              <ion-button
                expand="block"
                size="large"
                [disabled]="!formPagePrimary.valid"
                (click)="submitLogin()"
                class="btn-login">
                <ion-icon name="log-in" slot="start"></ion-icon>
                Accedi
              </ion-button>

              <!-- Link Password Dimenticata -->
              <div class="forgot-password" (click)="changeForm()">
                <ion-icon name="help-circle"></ion-icon>
                <span>Hai dimenticato la password?</span>
              </div>

            </form>

            <!-- Benefits -->
            <div class="benefits-list">
              <div class="benefit-item">
                <ion-icon name="checkmark-circle" color="success"></ion-icon>
                <span>Eventi e programmazione corsi</span>
              </div>
              <div class="benefit-item">
                <ion-icon name="checkmark-circle" color="success"></ion-icon>
                <span>Prenotazioni e iscrizioni</span>
              </div>
              <div class="benefit-item">
                <ion-icon name="checkmark-circle" color="success"></ion-icon>
                <span>Rimani in contatto con noi</span>
              </div>
            </div>             

          </div>

          <!-- ================================ -->
          <!-- FORM RECOVERY PASSWORD -->
          <!-- ================================ -->
          <div class="form-container" *ngIf="indexShowForm == 2">
            
            <!-- Header -->
            <div class="form-header">
              <ion-icon name="key" class="form-icon"></ion-icon>
              <h2>Recupera Password</h2>
              <p *ngIf="stepRecovery == 'input'">Ti invieremo un codice per reimpostare la password</p>
              <p *ngIf="stepRecovery == 'code'">Inserisci il codice ricevuto</p>
              <p *ngIf="stepRecovery == 'password'">Imposta la nuova password</p>
            </div>

            <!-- Steps Indicator -->
            <div class="steps-indicator">
              <div class="step" [class.active]="stepRecovery == 'input'" [class.completed]="stepRecovery != 'input'">
                <div class="step-number">1</div>
                <span>Richiedi</span>
              </div>
              <div class="step-line" [class.completed]="stepRecovery != 'input'"></div>
              <div class="step" [class.active]="stepRecovery == 'code'" [class.completed]="stepRecovery == 'password'">
                <div class="step-number">2</div>
                <span>Verifica</span>
              </div>
              <div class="step-line" [class.completed]="stepRecovery == 'password'"></div>
              <div class="step" [class.active]="stepRecovery == 'password'">
                <div class="step-number">3</div>
                <span>Nuova</span>
              </div>
            </div>

            <!-- Info Text -->
            <div class="info-box">
              <ion-icon name="information-circle"></ion-icon>
              <div class="info-text">
                <p *ngIf="recoveryMode == 'mail' && stepRecovery == 'input'">
                  Inserisci l'email usata in fase di registrazione. Riceverai un codice via email.
                </p>
                <p *ngIf="recoveryMode == 'mobile' && stepRecovery == 'input'">
                  Inserisci il numero mobile usato in fase di registrazione. Riceverai un SMS con il codice.
                </p>
                <p *ngIf="recoveryMode == 'all' && stepRecovery == 'input'">
                  Inserisci email o numero mobile. Riceverai il codice di verifica.
                </p>
                <p *ngIf="stepRecovery == 'code'">
                  Controlla la tua {{docRichiestaCodici?.REQUESTEMAILCODE ? 'email' : 'SMS'}} e inserisci il codice ricevuto.
                </p>
                <p *ngIf="stepRecovery == 'password'">
                  Imposta una nuova password sicura per il tuo account.
                </p>
              </div>
            </div>

            <!-- Form -->
            <form [formGroup]="formPageSecondary" class="recovery-form">
              
              <!-- Email/Telefono (Step 1) -->
              <div class="form-field" *ngIf="stepRecovery == 'input' || stepRecovery == 'code'">
                <ion-icon 
                  [name]="recoveryMode == 'mobile' ? 'call' : 'mail'" 
                  class="field-icon">
                </ion-icon>
                <ion-input
                  [label]="labelFormRecovery"
                  labelPlacement="floating"
                  [type]="recoveryMode == 'mobile' ? 'tel' : 'email'"
                  formControlName="profileEmailNumber"
                  [placeholder]="helperFormRecovery"
                  [clearInput]="stepRecovery == 'input'">
                </ion-input>
              </div>

              <!-- Codice Verifica (Step 2 e 3) -->
              <div class="form-field" *ngIf="stepRecovery == 'code' || stepRecovery == 'password'">
                <ion-icon name="shield-checkmark" class="field-icon"></ion-icon>
                <ion-input
                  label="Codice di verifica"
                  labelPlacement="floating"
                  type="text"
                  formControlName="verificationCode"
                  placeholder="Inserisci il codice"
                  maxlength="5">
                </ion-input>
                <ion-button
                  *ngIf="stepRecovery == 'code'"
                  (click)="onClickReinviaCodice()"
                  fill="clear"
                  size="small"
                  class="resend-button">
                  Reinvia
                </ion-button>
              </div>

              <!-- Password 1 (Step 3) -->
              <div class="form-field" *ngIf="stepRecovery == 'password'">
                <ion-icon name="lock-closed" class="field-icon"></ion-icon>
                <ion-input
                  #password1
                  label="Nuova Password"
                  labelPlacement="floating"
                  type="password"
                  formControlName="password1"
                  placeholder="Inserisci password">
                </ion-input>
                <ion-button
                  (click)="showHideInput('password1',password1)"
                  fill="clear"
                  size="small"
                  class="eye-button">
                  <ion-icon 
                    [name]="showPassword1 ? 'eye-off' : 'eye'" 
                    slot="icon-only">
                  </ion-icon>
                </ion-button>
              </div>

              <!-- Password 2 (Step 3) -->
              <div class="form-field" *ngIf="stepRecovery == 'password'">
                <ion-icon name="lock-closed" class="field-icon"></ion-icon>
                <ion-input
                  #password2
                  label="Ripeti Password"
                  labelPlacement="floating"
                  type="password"
                  formControlName="password2"
                  placeholder="Ripeti password">
                </ion-input>
                <ion-button
                  (click)="showHideInput('password2',password2)"
                  fill="clear"
                  size="small"
                  class="eye-button">
                  <ion-icon 
                    [name]="showPassword2 ? 'eye-off' : 'eye'" 
                    slot="icon-only">
                  </ion-icon>
                </ion-button>
              </div>

              <!-- Bottone Azione -->
              <ion-button
                expand="block"
                size="large"
                [disabled]="!formPageSecondary.valid"
                (click)="onClickActionRecovery()"
                class="btn-recovery">
                <ion-icon 
                  [name]="stepRecovery == 'input' ? 'send' : (stepRecovery == 'code' ? 'checkmark-circle' : 'key')" 
                  slot="start">
                </ion-icon>
                {{stepRecovery == 'input' ? 'Richiedi codice' : (stepRecovery == 'code' ? 'Verifica codice' : 'Conferma Password')}}
              </ion-button>

              <!-- Link Torna a Login -->
              <div class="back-to-login" (click)="changeForm()">
                <ion-icon name="arrow-back-circle"></ion-icon>
                <span>Torna al login</span>
              </div>

            </form>

          </div>

        </ion-col>

      </ion-row>
    </ion-grid>
  </div>

</ion-content>