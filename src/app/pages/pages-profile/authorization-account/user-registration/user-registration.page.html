<ion-header>
  <ion-toolbar color="primary">
      <ion-buttons slot="start">
          <ion-button 
                  (click)="closeModal()"
                  fill="clear">
              <ion-icon name="close" slot="icon-only"></ion-icon>
          </ion-button>
      </ion-buttons>
      <ion-title>REGISTRAZIONE</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <!-- CONTAINER CENTRALE -->
  <div class="registration-container">
    
    <!-- CARD PRINCIPALE -->
    <div class="registration-card">

      <!-- ICONA PRINCIPALE CENTRALE -->
      <div class="icon-header">
        <div class="icon-circle" [ngClass]="{'step-input': stepRegistration == 'input', 'step-code': stepRegistration == 'code', 'step-final': stepRegistration == 'final'}">
          <ion-icon *ngIf="stepRegistration == 'input'" name="person-add"></ion-icon>
          <ion-icon *ngIf="stepRegistration == 'code'" name="key"></ion-icon>
          <ion-icon *ngIf="stepRegistration == 'final'" name="checkmark-circle"></ion-icon>
        </div>
      </div>

      <!-- TITOLO STEP -->
      <h1 class="registration-title" *ngIf="stepRegistration != 'final'">
        {{stepRegistration == 'input' ? 'REGISTRATI' : 'VERIFICA E COMPLETA'}}
      </h1>
      <h1 class="registration-title" *ngIf="stepRegistration == 'final'">
        BENVENUTO!
      </h1>

      <!-- STEPPER VISIVO (solo per step input e code) -->
      <div class="stepper-container" *ngIf="stepRegistration != 'final'">
        <div class="step-item" [class.active]="stepRegistration == 'input'">
          <div class="step-number">1</div>
        </div>
        <div class="step-line"></div>
        <div class="step-item" [class.active]="stepRegistration == 'code'">
          <div class="step-number">2</div>
        </div>
        <div class="step-line"></div>
        <div class="step-item">
          <div class="step-number">3</div>
        </div>
      </div>

      <!-- INFO BOX GIALLO CON ISTRUZIONI -->
      <div class="info-box" *ngIf="stepRegistration != 'final'">
        <ion-icon name="information-circle" class="info-icon"></ion-icon>
        <p [innerHTML]="informationText | safeHtml"></p>
      </div>

      <!-- LINK ACCEDI (solo step input) -->
      <div class="login-banner" (click)="closeModal(true)">
        <ion-icon name="person-add" color="danger"></ion-icon>
        <div class="login-banner-text">
          <p>Hai gi&agrave; un account ?</p>
          <span>Accedi ora</span>
        </div>
        <ion-icon name="chevron-forward" color="danger"></ion-icon>
      </div>      

      <!-- ========== STEP 1: INPUT DATI ========== -->
      <form [formGroup]="formPagePrimary" *ngIf="stepRegistration == 'input'">
        
        <!-- NOME -->
        <div class="input-group">
          <ion-icon name="person" class="input-icon"></ion-icon>
          <ion-input
                label="Nome"
                labelPlacement="floating"
                placeholder="Inserisci il tuo nome"
                [clearInput]="true"
                formControlName="profileName"
                type="text">
          </ion-input>
        </div>

        <!-- COGNOME -->
        <div class="input-group">
          <ion-icon name="person" class="input-icon"></ion-icon>
          <ion-input
                label="Cognome"
                labelPlacement="floating"
                placeholder="Inserisci il tuo cognome"
                [clearInput]="true"
                formControlName="profileSurname"
                type="text">
          </ion-input>
        </div>

        <!-- EMAIL -->
        <div class="input-group">
          <ion-icon name="mail" class="input-icon"></ion-icon>
          <ion-input
                label="E-mail"
                labelPlacement="floating"
                placeholder="indirizzo@email.com"
                [clearInput]="true"
                formControlName="profileEmail"
                type="email">
          </ion-input>
        </div>

        <!-- MOBILE -->
        <div class="input-group">
          <ion-icon name="call" class="input-icon"></ion-icon>
          <ion-input
              label="Numero Mobile"
              labelPlacement="floating"
              placeholder="+39 3xx xxx xxxx"
              [clearInput]="true"
              formControlName="profileMobile"
              type="tel">
          </ion-input>
        </div>

      </form>

      <!-- ========== STEP 2: VERIFICA E PASSWORD ========== -->
      <form [formGroup]="formPagePrimary" *ngIf="stepRegistration == 'code'">
        
        <!-- NOMINATIVO -->
        <div class="user-info">
          <h3>{{fullNominativo}}</h3>
          <p>{{fullEmail}}</p>
          <p class="mobile-number">{{fullMobileNumber}}</p>
        </div>

        <!-- CODICE VERIFICA EMAIL -->
        <div class="input-group" *ngIf="getFlagshowInput('verificationMailCode')">
          <ion-icon name="mail" class="input-icon"></ion-icon>
          <ion-input
                label="Codice verifica E-mail"
                labelPlacement="floating"
                placeholder="Inserisci codice ricevuto"
                [clearInput]="false"
                formControlName="verificationMailCode"
                type="text">
          </ion-input>
          <ion-button
              (click)="onRequestReinvioCode('mail')"
              fill="clear"
              size="small"
              class="reinvia-btn">
              Reinvia
          </ion-button>
        </div>

        <!-- CODICE VERIFICA SMS -->
        <div class="input-group" *ngIf="getFlagshowInput('verificationSmsCode')">
          <ion-icon name="chatbox" class="input-icon"></ion-icon>
          <ion-input
                label="Codice verifica SMS"
                labelPlacement="floating"
                placeholder="Inserisci codice ricevuto"
                [clearInput]="false"
                formControlName="verificationSmsCode"
                type="text">
          </ion-input>
          <ion-button
              (click)="onRequestReinvioCode('mobile')"
              fill="clear"
              size="small"
              class="reinvia-btn">
              Reinvia
          </ion-button>
        </div>

        <!-- PASSWORD -->
        <div class="input-group">
          <ion-icon name="lock-closed" class="input-icon"></ion-icon>
          <ion-input
                #password1
                id="password1"
                label="Password"
                labelPlacement="floating"
                placeholder="Crea una password"
                [clearInput]="false"
                formControlName="password1"
                type="password">
          </ion-input>
          <ion-button
              (click)="showHideInput('password1',password1)"
              fill="clear"
              size="small"
              class="toggle-pwd-btn">
              <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
          </ion-button>
        </div>

        <!-- RIPETI PASSWORD -->
        <div class="input-group">
          <ion-icon name="lock-closed" class="input-icon"></ion-icon>
          <ion-input
                id="password2"
                #password2
                label="Ripeti Password"
                labelPlacement="floating"
                placeholder="Conferma password"
                [clearInput]="false"
                formControlName="password2"
                type="password">
          </ion-input>
          <ion-button
              (click)="showHideInput('password2',password2)"
              fill="clear"
              size="small"
              class="toggle-pwd-btn">
              <ion-icon slot="icon-only" name="eye-outline"></ion-icon>
          </ion-button>
        </div>

        <!-- LINK POLICY -->
        <div class="policy-link" *ngIf="linkPolicy.length != 0">
          <ion-button
              (click)="openPolicyLink()"
              fill="clear"
              size="small">
              <ion-icon name="document-text" slot="start"></ion-icon>
              Leggi le condizioni di registrazione
          </ion-button>
        </div>

        <!-- CHECKBOX CONDIZIONI -->
        <div class="checkbox-group">
          <ion-checkbox formControlName="flagConditionReading"></ion-checkbox>
          <label>
            {{linkPolicy.length != 0 ? 'Ho letto ed accetto le condizioni' : 'Accetto le condizioni'}}
          </label>
        </div>

        <!-- CHECKBOX NEWSLETTER -->
        <div class="checkbox-group">
          <ion-checkbox formControlName="flagNewsletter"></ion-checkbox>
          <label>Voglio ricevere newsletter dal centro</label>
        </div>

      </form>

      <!-- ========== STEP 3: REGISTRAZIONE COMPLETATA ========== -->
      <div class="final-step" *ngIf="stepRegistration == 'final'">
        
        <div class="success-message">
          <h2>{{fullNominativo}}</h2>
          <p>La registrazione si Ã¨ conclusa con successo!</p>
          <p class="credentials-info">
            Potrai effettuare il login utilizzando l'email 
            <strong>{{fullEmail}}</strong> e la password scelta.
          </p>
        </div>

        <!-- LISTA BENEFICI -->
        <div class="benefits-list">
          
          <div class="benefit-item">
            <div class="benefit-icon">
              <ion-icon name="checkmark" color="success"></ion-icon>
            </div>
            <p>Scopri i corsi che abbiamo pensato per te</p>
          </div>

          <div class="benefit-item">
            <div class="benefit-icon">
              <ion-icon name="checkmark" color="success"></ion-icon>
            </div>
            <p>Organizza un incontro e prenota uno dei nostri campi</p>
          </div>

          <div class="benefit-item">
            <div class="benefit-icon">
              <ion-icon name="checkmark" color="success"></ion-icon>
            </div>
            <p>Rimani aggiornato su tutti i nostri eventi</p>
          </div>

          <div class="benefit-item">
            <div class="benefit-icon">
              <ion-icon name="checkmark" color="success"></ion-icon>
            </div>
            <p>Invia certificati medici e altri documenti in formato digitale</p>
          </div>

        </div>

      </div>

      <!-- BOTTONE AZIONE PRINCIPALE -->
      <ion-button
          *ngIf="stepRegistration != 'final'"
          (click)="onClickActionRegistration()"
          class="action-button"
          expand="block"
          size="large">
          <ion-icon name="arrow-forward" slot="end"></ion-icon>
          {{stepRegistration == 'input' ? 'CONTINUA' : 'REGISTRATI'}}
      </ion-button>

      <!-- BOTTONE ACCEDI (final step) -->
      <ion-button
          *ngIf="stepRegistration == 'final'"
          (click)="closeModal(true)"
          class="action-button success"
          expand="block"
          size="large">
          <ion-icon name="log-in" slot="end"></ion-icon>
          ACCEDI
      </ion-button>

    </div>

  </div>

</ion-content>