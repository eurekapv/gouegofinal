<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="backButtonHref"></ion-back-button>
    </ion-buttons>
    <ion-title>TESSERAMENTI</ion-title>
  </ion-toolbar> 
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="page-container">

    <!-- INFO BOX -->
    <div class="info-box">
      <ion-icon name="information-circle" class="info-icon"></ion-icon>
      <p>Qui trovi l'elenco delle tessere associative disponibili al centro; puoi verificarne la scadenza ed eventualmente scaricare i moduli per la richiesta iscrizione</p>
    </div>

    <!-- ACCORDION GROUPS -->
    <ion-accordion-group 
          #accordiontessere
          [multiple]="true"
          class="cards-accordion">
      
      <!-- SINGOLA CATEGORIA TESSERA -->
      <ion-accordion 
          *ngFor="let itemTipo of listTipoTessere" 
          [value]="itemTipo.ID"
          class="category-accordion">
        
        <!-- HEADER ACCORDION -->
        <div slot="header" class="accordion-header">
          <div class="header-icon">
            <ion-icon [name]="itemTipo.FLAGCLUB ? 'home':'planet'"></ion-icon>
          </div>
          <div class="header-content">
            <h3>{{itemTipo.DENOMINAZIONE}}</h3>
          </div>
          <div class="header-arrow">
            <ion-icon name="chevron-down"></ion-icon>
          </div>
        </div>

        <!-- CONTENT ACCORDION -->
        <div slot="content" class="accordion-content">

          <!-- NESSUNA TESSERA PRESENTE -->
          <div class="empty-cards" *ngIf="existListTessereUtente(itemTipo.ID)==false">
            <ion-icon name="card-outline"></ion-icon>
            <p>Non sono presenti tessere di questa tipologia</p>
          </div>

          <!-- LISTA TESSERE UTENTE -->
          <div class="membership-cards" *ngIf="existListTessereUtente(itemTipo.ID)">
            
            <div 
                *ngFor="let itemTessera of listTessereUtente"
                class="membership-card-wrapper">
              
              <!-- CARD TESSERA -->
              <div 
                  *ngIf="itemTessera.IDTIPOTESSERA == itemTipo.ID"
                  class="membership-card"
                  [class.valid]="itemTessera.isValid()"
                  [class.expired]="!itemTessera.isValid()">
                
                <!-- Header Card -->
                <div class="card-header">
                  <div class="card-status">
                    <ion-icon [name]="itemTessera.isValid() ? 'checkmark-circle' : 'close-circle'"></ion-icon>
                    <span>{{itemTessera.isValid() ? 'Tessera Valida' : 'Tessera Scaduta'}}</span>
                  </div>
                </div>

                <!-- Body Card -->
                <div class="card-body">
                  
                  <!-- Info Tessera -->
                  <div class="card-info">
                    <div class="card-number">
                      <ion-icon name="card"></ion-icon>
                      <span>{{itemTessera.CODICE}}</span>
                    </div>
                    <div class="card-expiry">
                      <ion-icon name="calendar"></ion-icon>
                      <div>
                        <p class="expiry-label">Scadenza</p>
                        <p class="expiry-date">{{itemTessera.DATASCADENZA | date : 'dd/MM/yyyy'}}</p>
                      </div>
                    </div>
                  </div>

                  <!-- QR Code (se presente) -->
                  <div class="card-qr" *ngIf="flagShowQRCode(itemTessera)">
                    <qrcode 
                        [qrdata]="itemTessera.getQrCode()" 
                        [colorLight]="itemTessera.isValid() ? '#ffffff':'#ffffff'"
                        [colorDark]="itemTessera.isValid() ? '#2cb361':'#df413a'"
                        [width]="120">
                    </qrcode>
                  </div>

                </div>

              </div>

            </div>

          </div>

          <!-- MODULI DA SCARICARE -->
          <div class="modules-section" *ngIf="itemTipo.TIPITESSERETEMPLATE.length != 0">
            
            <h4 class="modules-title">
              <ion-icon name="document-text"></ion-icon>
              Moduli richieste
            </h4>

            <div class="modules-list">
              <div 
                  class="module-item"
                  *ngFor="let itemTemplate of itemTipo.TIPITESSERETEMPLATE"
                  (click)="onDownloadTemplate(itemTemplate)">
                
                <div class="module-icon">
                  <ion-icon name="document-attach"></ion-icon>
                </div>
                
                <div class="module-info">
                  <p>{{itemTemplate.DESCRIZIONE}}</p>
                </div>

                <div class="module-download">
                  <ion-icon name="cloud-download"></ion-icon>
                </div>

              </div>
            </div>

          </div>

        </div>

      </ion-accordion>

    </ion-accordion-group>

  </div>

</ion-content>