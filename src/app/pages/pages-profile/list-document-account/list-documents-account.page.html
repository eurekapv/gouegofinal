<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="backButtonHref"></ion-back-button>
    </ion-buttons>
    <ion-title>DOCUMENTI</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="requestListaDocumenti($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="page-container">

    <!-- INFO BOX + BOTTONE INVIA -->
    <div class="info-section">
      <div class="info-box">
        <ion-icon name="information-circle" class="info-icon"></ion-icon>
        <div class="info-text">
          <p *ngIf="listaTipiDocumento?.length == 0">
            Qui trovi l'elenco dei documenti e certificati medici che ci hai consegnato
          </p>
          <p *ngIf="listaTipiDocumento?.length != 0">
            Qui trovi l'elenco dei documenti e certificati medici che ci hai consegnato; puoi anche inviarci nuovi documenti
          </p>
        </div>
      </div>

      <!-- Bottone Invia (se disponibile) -->
      <ion-button
          *ngIf="listaTipiDocumento?.length != 0"
          (click)="onAddDocument()"
          class="upload-button"
          expand="block"
          size="large">
          <ion-icon name="cloud-upload" slot="start"></ion-icon>
          Invia Documento
      </ion-button>
    </div>

    <!-- LISTA DOCUMENTI -->
    <div class="documents-grid" *ngIf="listDocumenti.length > 0">
      
      <div class="document-card" 
           *ngFor="let documento of listDocumenti"
           (click)="onClickElement(documento)">
        
        <!-- Icona documento -->
        <div class="document-icon">
          <ion-icon name="document-text"></ion-icon>
        </div>

        <!-- Contenuto documento -->
        <div class="document-content">
          
          <!-- Tipo documento -->
          <h3 class="document-title">
            {{documento['_DENOMINAZIONE_TipoDocumentazione']}}
          </h3>

          <!-- Data modifica -->
          <p class="document-date">
            <ion-icon name="calendar-outline"></ion-icon>
            Ultima modifica: {{documento.DATAORAMODIFICA | date : 'dd/MM/yyyy'}}
          </p>

          <!-- Badge stato -->
          <div class="document-status">
            
            <!-- In attesa di verifica -->
            <ion-badge 
                *ngIf="documento.REQUESTCONTROLLO"
                class="status-badge pending">
                <ion-icon name="time-outline"></ion-icon>
                In attesa di verifica
            </ion-badge>

            <!-- Scaduto -->
            <ion-badge 
                *ngIf="!documento.REQUESTCONTROLLO && !documento.checkValidita()"
                class="status-badge expired">
                <ion-icon name="close-circle"></ion-icon>
                Scaduto
            </ion-badge>

            <!-- Valido -->
            <ion-badge 
                *ngIf="!documento.REQUESTCONTROLLO && documento.checkValidita()"
                class="status-badge valid">
                <ion-icon name="checkmark-circle"></ion-icon>
                Valido
            </ion-badge>

          </div>

        </div>

        <!-- Bottone download -->
        <div class="download-button">
          <ion-icon name="cloud-download"></ion-icon>
        </div>

      </div>

    </div>

    <!-- EMPTY STATE -->
    <div class="empty-state" *ngIf="listDocumenti.length === 0">
      <div class="empty-icon">
        <ion-icon name="document-text-outline"></ion-icon>
      </div>
      <h3>Nessun documento</h3>
      <p>Non hai ancora caricato documenti</p>
      
      <!-- Bottone Invia nell'empty state -->
      <ion-button
          *ngIf="listaTipiDocumento?.length != 0"
          (click)="onAddDocument()"
          class="empty-upload-button"
          size="default">
          <ion-icon name="cloud-upload" slot="start"></ion-icon>
          Invia il tuo primo documento
      </ion-button>
    </div>

  </div>

</ion-content>